<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SamrtLearn</title>
    <script type="module" crossorigin src="/assets/index-BU1Bvb4D.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-D2QgOjtK.css">
    <style>
      .open-injected{cursor:pointer;background:var(--color-purple-700,#6b21a8);color:#fff;border:none;padding:0.35rem 0.7rem;border-radius:0.375rem;font-size:0.875rem}
      .open-injected:hover{background:var(--color-purple-800,#581c87)}
      [data-course-content]{white-space:pre-wrap}
      .course-title{font-weight:600;font-size:var(--text-xl,1.25rem);margin-bottom:0.5rem}
      .nav-link{transition:color .15s ease}
      .nav-link.active{color:var(--color-purple-700,#6b21a8);text-decoration:none;border-bottom:2px solid var(--color-purple-700,#6b21a8)}
      .course-form-constrained{max-width:56rem;margin:0 auto}
      .course-card-constrained{max-width:56rem;margin:0 auto}
      .editor-large{min-height:420px}
      .delete-btn{cursor:pointer;background:#ef4444;color:#fff;border:none;padding:0.3rem 0.6rem;border-radius:0.375rem;font-size:0.75rem;margin-left:0.5rem}
      .delete-btn:hover{background:#dc2626}
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script>
      (function(){
        function isCoursesPage(){
          var input=document.querySelector('input[placeholder="New course title"]');
          return !!input;
        }
        function getSection(){
          var p=(location.pathname||'/').toLowerCase();
          if(p.includes('/courses')) return 'courses';
          if(p.includes('/assignments')) return 'assignments';
          if(p.includes('/gradebook')) return 'gradebook';
          if(p.includes('/announcements')) return 'announcements';
          if(p.includes('/submissions')) return 'submissions';
          return 'unknown';
        }
        function isAdmin(){
          var txt=document.body.textContent||'';
          return /\(admin\)/i.test(txt);
        }
        function loadDeletes(section){
          try{ return JSON.parse(localStorage.getItem('deletes:'+section)||'[]'); }catch(e){ return []; }
        }
        function saveDeletes(section,list){
          try{ localStorage.setItem('deletes:'+section, JSON.stringify(list||[])); }catch(e){}
        }
        function addDeleteButton(card,title,section){
          if(!isAdmin()) return;
          var btn=document.createElement('button');
          btn.className='delete-btn';
          btn.textContent='Delete';
          btn.addEventListener('click',function(e){
            e.preventDefault();
            var list=loadDeletes(section);
            if(title && list.indexOf(title)===-1){ list.push(title); saveDeletes(section,list); }
            card.remove();
          });
          var first=card.firstChild; card.insertBefore(btn, first?first.nextSibling:null);
        }
        function findHeading(el){
          return el.querySelector('h1, h2, h3, strong, b');
        }
        function normalizeText(t){
          return (t||'').replace(/\s+/g,' ').trim();
        }
        function courseCards(){
          var root=document.getElementById('root');
          if(!root) return [];
          var blocks=[].slice.call(root.querySelectorAll('div'));
          return blocks.filter(function(card){
            var head=findHeading(card);
            if(!head) return false;
            var txt=normalizeText(card.textContent||'');
            return txt.length>200;
          });
        }
        var originalRootHTML=null;
        function showCourseContent(title, text){
          var root=document.getElementById('root');
          if(!root) return;
          if(originalRootHTML==null){ originalRootHTML=root.innerHTML; }
          window.history.pushState({view:'course'},'', '/courses/view');
          root.innerHTML='';
          var wrap=document.createElement('div');
          var h=document.createElement('h1'); h.textContent=title||'Course';
          var back=document.createElement('button'); back.textContent='Back'; back.className='open-injected';
          var content=document.createElement('div'); content.style.whiteSpace='pre-wrap'; content.textContent=text||'';
          back.addEventListener('click',function(){
            window.history.pushState({},'', '/courses');
            root.innerHTML=originalRootHTML;
            originalRootHTML=null;
            setTimeout(function(){ ensureCourses(); },0);
          });
          wrap.appendChild(h); wrap.appendChild(back); wrap.appendChild(content);
          root.appendChild(wrap);
        }
        function transformCard(card){
          if(card.getAttribute('data-transformed')) return;
          var head=findHeading(card);
          if(!head) return;
          var openBtn=[].slice.call(card.querySelectorAll('button, a')).find(function(b){
            return normalizeText(b.textContent).toLowerCase()==='open';
          });
          var rawText=(card.textContent||'').trim();
          var titleText=(head.textContent||'').trim()||rawText.split(/\n|\r/)[0].trim();
          var contentDiv=document.createElement('div');
          contentDiv.setAttribute('data-course-content','1');
          contentDiv.style.whiteSpace='pre-wrap';
          contentDiv.style.display='none';
          contentDiv.textContent=rawText;
          var titleBar=document.createElement('div');
          titleBar.className='course-title';
          titleBar.textContent=titleText||'Course';
          var btn=openBtn||document.createElement('button');
          if(!openBtn){
            btn.textContent='Open';
            btn.className='open-injected';
          }
          while(card.firstChild){ card.removeChild(card.firstChild); }
          card.appendChild(titleBar);
          card.appendChild(btn);
          addDeleteButton(card,titleText,'courses');
          card.appendChild(contentDiv);
          if(!btn.getAttribute('data-bound')){
            btn.setAttribute('data-bound','1');
            btn.addEventListener('click',function(e){
              e.preventDefault();
              showCourseContent(titleText, contentDiv.textContent||'');
            });
          }
          card.setAttribute('data-transformed','1');
        }
        function ensureCourses(){
          processCourses();
          constrainCourseUI();
          enhanceEditors();
          enhanceNav();
        }
        function processCourses(){
          if(!isCoursesPage()) return;
          courseCards().forEach(transformCard);
        }
        function constrainCourseUI(){
          if(!isCoursesPage()) return;
          var input=document.querySelector('input[placeholder="New course title"]');
          if(input){
            var form=input.parentElement;
            if(form && !form.classList.contains('course-form-constrained')){
              form.classList.add('course-form-constrained');
            }
          }
          courseCards().forEach(function(card){
            var head=findHeading(card); var title=(head&&head.textContent||'').trim();
            var deleted=loadDeletes('courses');
            if(title && deleted.indexOf(title)!==-1){ card.remove(); return; }
            if(!card.classList.contains('course-card-constrained')){
              card.classList.add('course-card-constrained');
            }
          });
        }
        function injectDeleteButtonsForOtherSections(){
          var section=getSection();
          if(section==='courses') return; // handled elsewhere
          if(!isAdmin()) return;
          var root=document.getElementById('root'); if(!root) return;
          var cards=[].slice.call(root.querySelectorAll('div')).filter(function(d){ return findHeading(d); });
          var deleted=loadDeletes(section);
          cards.forEach(function(card){
            var head=findHeading(card); var title=(head&&head.textContent||'').trim();
            if(title && deleted.indexOf(title)!==-1){ card.remove(); return; }
            addDeleteButton(card,title,section);
          });
        }
        function enhanceEditors(){
          var areas=document.querySelectorAll('textarea');
          areas.forEach(function(t){
            t.classList.add('editor-large');
            t.style.whiteSpace='pre-wrap';
            t.style.overflow='auto';
            try{ t.selectionStart=0; t.selectionEnd=0; }catch(e){}
            t.scrollTop=0;
            t.addEventListener('paste',function(){
              setTimeout(function(){ t.scrollTop=0; t.selectionStart=0; t.selectionEnd=0; },0);
            });
          });
        }
        function enhanceNav(){
          var links=document.querySelectorAll('nav a, header a, .topbar a');
          if(!links.length) return;
          links.forEach(function(a){ a.classList.add('nav-link'); });
          function setActive(el){
            links.forEach(function(x){ x.classList.remove('active'); });
            el.classList.add('active');
          }
          links.forEach(function(a){
            a.addEventListener('click',function(){ setActive(a); });
          });
          var current=[].slice.call(links).find(function(a){
            var href=(a.getAttribute('href')||'');
            return href && location.pathname.indexOf(href)>-1;
          }) || links[0];
          if(current) current.classList.add('active');
        }
        var root=document.getElementById('root');
        if(root){
          var mo=new MutationObserver(function(){ensureCourses();injectDeleteButtonsForOtherSections();});
          mo.observe(root,{childList:true,subtree:true});
        }
        window.addEventListener('load',function(){ensureCourses();injectDeleteButtonsForOtherSections();});
      })();
    </script>
  </body>
  </html>
